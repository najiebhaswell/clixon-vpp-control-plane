<?xml version="1.0" encoding="UTF-8"?>
<!--
  Example VPP Configuration - LACP Bond with VLAN and LCP
  
  This example demonstrates:
  1. Creating LACP bond (BondEthernet0)
  2. Adding physical interfaces as members
  3. Creating VLAN sub-interface
  4. Setting IP addresses
  5. Creating LCP pair for Linux integration
  
  Load with: ./restconf-config-loader.sh example-lacp-bond.xml
-->
<config xmlns:if="http://example.com/vpp/interfaces"
        xmlns:bond="http://example.com/vpp/bonds"
        xmlns:lcp="http://example.com/vpp/lcp">
  
  <!--
    Bonds must be created before interfaces are assigned to them
    Structure: bond-interface -> name, id, mode, load-balance
  -->
  <bond:bonds>
    <bond:bond>
      <bond:name>BondEthernet0</bond:name>
      <bond:id>0</bond:id>
      <bond:mode>lacp</bond:mode>
      <bond:load-balance>l23</bond:load-balance>
    </bond:bond>
  </bond:bonds>
  
  <!--
    Interface configuration
    - Physical interfaces that will be bonded
    - Bond interface with IP configuration
    - VLAN sub-interface
  -->
  <if:interfaces>
    
    <!-- Physical interface #1 - member of bond -->
    <if:interface>
      <if:name>GigabitEthernet0/0/0</if:name>
      <if:enabled>true</if:enabled>
      <if:mtu>9000</if:mtu>
      <if:channel-group>0</if:channel-group>
    </if:interface>
    
    <!-- Physical interface #2 - member of bond -->
    <if:interface>
      <if:name>GigabitEthernet0/0/1</if:name>
      <if:enabled>true</if:enabled>
      <if:mtu>9000</if:mtu>
      <if:channel-group>0</if:channel-group>
    </if:interface>
    
    <!-- Bond interface with IP address -->
    <if:interface>
      <if:name>BondEthernet0</if:name>
      <if:enabled>true</if:enabled>
      <if:mtu>9000</if:mtu>
      <if:ipv4-address>
        <if:address>192.168.1.1</if:address>
        <if:prefix-length>24</if:prefix-length>
      </if:ipv4-address>
      <if:description>LACP Bond Interface</if:description>
    </if:interface>
    
    <!-- VLAN 100 sub-interface on bond -->
    <if:interface>
      <if:name>BondEthernet0.100</if:name>
      <if:enabled>true</if:enabled>
      <if:vlan>100</if:vlan>
      <if:ipv4-address>
        <if:address>10.0.100.1</if:address>
        <if:prefix-length>24</if:prefix-length>
      </if:ipv4-address>
      <if:description>VLAN 100 - Data Plane</if:description>
    </if:interface>
    
    <!-- VLAN 200 sub-interface on bond -->
    <if:interface>
      <if:name>BondEthernet0.200</if:name>
      <if:enabled>true</if:enabled>
      <if:vlan>200</if:vlan>
      <if:ipv4-address>
        <if:address>10.0.200.1</if:address>
        <if:prefix-length>24</if:prefix-length>
      </if:ipv4-address>
      <if:ipv6-address>
        <if:address>2001:db8:200::1</if:address>
        <if:prefix-length>64</if:prefix-length>
      </if:ipv6-address>
      <if:description>VLAN 200 - IPv4 + IPv6</if:description>
    </if:interface>
    
    <!-- Loopback interface -->
    <if:interface>
      <if:name>loop0</if:name>
      <if:enabled>true</if:enabled>
      <if:ipv4-address>
        <if:address>127.0.0.1</if:address>
        <if:prefix-length>32</if:prefix-length>
      </if:ipv4-address>
      <if:description>Management Loopback</if:description>
    </if:interface>
    
  </if:interfaces>
  
  <!--
    LCP (Linux Control Plane) pairs
    Create Linux TAP interfaces paired with VPP interfaces
  -->
  <lcp:lcp-pairs>
    
    <!-- LCP for VLAN 100 in default namespace -->
    <lcp:lcp-pair>
      <lcp:vpp-interface>BondEthernet0.100</lcp:vpp-interface>
      <lcp:host-interface>vlan100</lcp:host-interface>
      <lcp:netns>default</lcp:netns>
    </lcp:lcp-pair>
    
    <!-- LCP for VLAN 200 in custom namespace -->
    <lcp:lcp-pair>
      <lcp:vpp-interface>BondEthernet0.200</lcp:vpp-interface>
      <lcp:host-interface>vlan200</lcp:host-interface>
      <lcp:netns>ns-dataplane</lcp:netns>
    </lcp:lcp-pair>
    
  </lcp:lcp-pairs>
  
</config>
